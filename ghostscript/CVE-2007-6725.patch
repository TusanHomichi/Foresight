--- src/scfd.c.orig	2008-06-23 13:55:47.000000000 +0100
+++ src/scfd.c	2008-06-23 14:39:27.000000000 +0100
@@ -161,7 +161,7 @@
 /* makeup codes efficiently, since these are always a multiple of 64. */
 #define invert_data(rlen, black_byte, makeup_action, d)\
 	if ( rlen > qbit )\
-	{	*q++ ^= (1 << qbit) - 1;\
+	{	if (q >= ss->lbuf) *q++ ^= (1 << qbit) - 1; else q++;\
 		rlen -= qbit;\
 		switch ( rlen >> 3 )\
 		{\

--- rubygems-1.5.0/test/rubygems/test_gem_installer.rb.umask	2011-01-29 06:52:19.000000000 +0900
+++ rubygems-1.5.0/test/rubygems/test_gem_installer.rb	2011-02-11 04:30:12.000000000 +0900
@@ -180,7 +180,7 @@
     assert_equal true, File.directory?(util_inst_bindir)
     installed_exec = File.join(util_inst_bindir, "my_exec")
     assert_equal true, File.exist?(installed_exec)
-    assert_equal(0100755, File.stat(installed_exec).mode) unless win_platform?
+    assert_equal(( 0100755 & (~ File.umask)), File.stat(installed_exec).mode) unless win_platform?
 
     wrapper = File.read installed_exec
     assert_match %r|generated by RubyGems|, wrapper
@@ -195,7 +195,7 @@
     assert_equal true, File.directory?(util_inst_bindir)
     installed_exec = File.join(util_inst_bindir, "my_exec")
     assert_equal true, File.exist?(installed_exec)
-    assert_equal(0100755, File.stat(installed_exec).mode) unless win_platform?
+    assert_equal(( 0100755 & (~ File.umask)), File.stat(installed_exec).mode) unless win_platform?
 
     wrapper = File.read installed_exec
     assert_match %r|generated by RubyGems|, wrapper
@@ -248,7 +248,7 @@
 
     installed_exec = File.join("#{@gemhome}2", 'bin', 'my_exec')
     assert_equal true, File.exist?(installed_exec)
-    assert_equal(0100755, File.stat(installed_exec).mode) unless win_platform?
+    assert_equal(( 0100755 & (~ File.umask)), File.stat(installed_exec).mode) unless win_platform?
 
     wrapper = File.read installed_exec
     assert_match %r|generated by RubyGems|, wrapper
@@ -294,7 +294,7 @@
 
     installed_exec = File.join @gemhome, 'bin', 'my_exec'
     assert_equal true, File.exist?(installed_exec)
-    assert_equal 0100755, File.stat(installed_exec).mode unless win_platform?
+    assert_equal ( 0100755 & (~ File.umask)), File.stat(installed_exec).mode unless win_platform?
 
     wrapper = File.read installed_exec
     assert_match %r|generated by RubyGems|, wrapper
@@ -319,7 +319,7 @@
     @installer.generate_bin
     assert_equal true, File.directory?(util_inst_bindir)
     assert_equal true, File.exist?(installed_exec)
-    assert_equal(0100755, File.stat(installed_exec).mode) unless win_platform?
+    assert_equal(( 0100755 & (~ File.umask)), File.stat(installed_exec).mode) unless win_platform?
 
     assert_match %r|generated by RubyGems|, File.read(installed_exec)
 
